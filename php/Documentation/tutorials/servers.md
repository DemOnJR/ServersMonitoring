# Tutorial: Servers

## Quick start
1. Open the list page: `/?page=servers`.
2. Click a server name to view details: `/?page=server&id=SERVER_ID`.
3. Use Public settings: `/?page=public&id=SERVER_ID`.

## What you can do
- See online/offline status and last seen.
- Rename or delete servers.
- Open public pages (if enabled).
- View charts, disks, filesystems, and uptime.

## Servers list (how it works)
File: `php/public/pages/servers/servers.php`

Key points:
- Loads server rows and latest metrics in one query.
- Online/offline is based on `OFFLINE_THRESHOLD`.
- CPU/RAM/Disk bars are hidden when offline (avoid stale data).
- Public settings are loaded in bulk to avoid N+1 queries.

Actions (AJAX):
- Rename: `POST /ajax/server.php?action=saveName` with `id`, `name`.
- Delete: `POST /ajax/server.php?action=delete` with `id`.
- Public toggle: `POST /ajax/public.php?action=toggleEnabled` with `id`, `enabled`.

## Server detail page
File: `php/public/pages/servers/server.php`

Shows:
- Summary cards (CPU/RAM/Disk/Network/Uptime).
- Charts (CPU+RAM, Network, Disk) via Chart.js.
- Uptime grid for today.
- Disks and filesystems tables.
- IP history (last 50).

Data sources:
- `MetricsService::today()` for charts + uptime grid.
- `MetricsService::latest()` for summary cards.
- `ServerRepository::getIpHistory()` for IP history.

## Reinstall agent
If a server has `agent_token`, the page shows an OS-specific command:
- Generated by `AgentInstall::fromServer()`.
- Uses `/install/machine/?os=linux|windows&token=...`.

If the token is missing, the UI shows a warning.

## Public page settings
File: `php/public/pages/servers/public.php`

Settings:
- Enable/disable public page.
- Slug (auto-generated with `-SERVER_ID` suffix).
- Optional password (private page).
- Visible widgets (CPU/RAM/Disk/Network/Uptime).

Save:
- `POST /ajax/public.php?action=saveSettings`
